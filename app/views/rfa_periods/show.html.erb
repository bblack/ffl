<h1>RFA Period
<span class="subtitle">
  <%= DateRange.new(@rfaperiod.open_date, @rfaperiod.close_date) %><br/>
  For contracts expiring following <%= @rfaperiod.final_year %> season
</span>
</h1>

<% if @current_team %>
  <span class="noticebox">
    <span style="font-weight:bold;">
      Just so you know,
    </span>
    your team, <%= @current_team.name %>, is allowed to bid up to <%= @current_team.max_rfa_bid(@rfaperiod.id) %>.
  </span>
<% end %>

<h2>Eligible players</h2>
<% @rfaperiod.league.teams.each do |team| %>
  <span style="display:inline-block; margin-right:1em;">
    <h3><%= team.name %></h3>
    <table>
      <tr>
        <th>Player</th>
        <th>Top bid</th>
      </tr>
      <% @rfaperiod.contracts_eligible.select { |c|  c.team_id == team.id }.each do |c| %>
        <tr>
          <td>
            <a href="/players/<%= c.player.id %>">
              <%= c.player.first_name %> <%= c.player.last_name %>
              <span style="font-variant:small-caps;">
                <%= c.player.position.downcase %>, <%= c.player.nfl_team.downcase %>
              </span>
            </a>
          </td>
          <td>
            <% max_bid = @bids.where(:player_id => c.player_id).order("value DESC").limit(1).first %>
            <% if max_bid %>
              <%= max_bid.value %>
              <span style="font-size:50%;"><%= max_bid.team.name %></span>
            <% end %>
          </td>
          <td>
            <%= form_tag("/rfa_bids", :method => "POST") do %>
              <%= hidden_field_tag(:rfa_period_id, @rfaperiod.id) %>
              <%= hidden_field_tag(:player_id, c.player.id) %>
              <%= text_field_tag(:value, '', :style => "width: 3em;") %>
              <%= submit_tag("Bid") %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </table>
  </span>
<% end %>